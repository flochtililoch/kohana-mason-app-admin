<comp>
	<php>
		<![CDATA[

		$init = FALSE;
		$forms = array(
			'dhandler' => 'main',
			'main' => 'domains',
			'domains' => 'confirm'
			);
			
		$data_rules = array(
			'main' => array(
				'name' => array(
					'regex' => array('/^[A-Za-z0-9-]+$/')
					),
				'locales' => 'i18n::valid_locale'
			));
			
		$data_filters = array(
			'main' => array(
				'name' => 'trim'
			));
		
		// PREPROCESS DATA
		switch($this->request->controller)
		{
			case 'dhandler' :
				$init = TRUE;
				break;

			case 'main' :
				
				break;
		}
		
		$controller = count($this->request->param()) ? $this->request->shift_param() : $this->request->controller;
		
		// TODO : CHECK FORM HERE
		if(array_key_exists($controller, $forms) && count($_POST))
		{
			$v = Validate::factory($_POST)->process($data_rules[$controller], $data_filters[$controller]);
			if($v === TRUE)
			{
				Session::instance()->set($controller, $_POST);
				$this->request->redirect(I18n::instance()->uri('create/'.$forms[$controller]));
			}
			else
			{
				echo Kohana::debug($v);
			}
		}
		elseif($controller === 'confirm')
		{
			//
			
			$app_data = array();
			foreach($forms as $form)
			{
				$app_data[$form] = Session::instance()->get($form);
				if(is_array($app_data[$form]))
				{
				
				}
			}
			
		}

		if($controller !== 'dhandler')
		{
			$form = array_flip($forms);
			$this->data = Session::instance()->get($form[$controller]);
		}

		]]>
	</php>
	<process>
		<key name="init">$init</key>
	</process>
</comp>